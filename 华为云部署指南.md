# åä¸ºäº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨åç§°**: Ubuntu-cn-south-1-JcF4
- **å…¬ç½‘IP**: 113.45.64.145
- **ç§ç½‘IP**: 172.31.1.147
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 24.04 server 64bit
- **é…ç½®**: 2æ ¸ 2GB å†…å­˜ 40GBå­˜å‚¨
- **åŒºåŸŸ**: åå—-å¹¿å·

---

## ğŸ” ç¬¬ä¸€æ­¥ï¼šé‡ç½®æœåŠ¡å™¨å¯†ç å¹¶ç™»å½•

### 1. åœ¨åä¸ºäº‘æ§åˆ¶å°é‡ç½®å¯†ç 

æ ¹æ®æ‚¨çš„æˆªå›¾ï¼Œæ‚¨éœ€è¦å…ˆè®¾ç½®å¯†ç ï¼š

1. **ç‚¹å‡»ç•Œé¢ä¸Šçš„"é…ç½®å®‰å…¨ç»„è§„åˆ™"é“¾æ¥**
2. **æˆ–è€…åœ¨æœåŠ¡å™¨åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°æ‚¨çš„æœåŠ¡å™¨**
3. **ç‚¹å‡»"æ›´å¤š" â†’ "é‡ç½®å¯†ç "**
4. **è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç **ï¼ˆå»ºè®®åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼‰
5. **é‡å¯æœåŠ¡å™¨ä½¿å¯†ç ç”Ÿæ•ˆ**

### 2. é…ç½®å®‰å…¨ç»„è§„åˆ™

ç¡®ä¿ä»¥ä¸‹ç«¯å£å·²å¼€æ”¾ï¼š
- **22ç«¯å£** (SSH) - ç”¨äºè¿œç¨‹ç™»å½•
- **80ç«¯å£** (HTTP) - ç”¨äºç½‘ç«™è®¿é—®
- **443ç«¯å£** (HTTPS) - ç”¨äºSSLåŠ å¯†è®¿é—®

**æ“ä½œæ­¥éª¤ï¼š**
1. è¿›å…¥åä¸ºäº‘æ§åˆ¶å°
2. æ‰¾åˆ°"å®‰å…¨ç»„"è®¾ç½®
3. æ·»åŠ å…¥æ–¹å‘è§„åˆ™ï¼š
   - åè®®ç«¯å£ï¼šTCP 22
   - æˆæƒå¯¹è±¡ï¼š0.0.0.0/0
   - é‡å¤æ·»åŠ TCP 80 å’Œ TCP 443

### 3. ç™»å½•æœåŠ¡å™¨

**æ–¹æ³•Aï¼šä½¿ç”¨åä¸ºäº‘æ§åˆ¶å° CloudShell**
1. åœ¨æœåŠ¡å™¨åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»"è¿œç¨‹ç™»å½•"
2. é€‰æ‹©"CloudShellç™»å½•"
3. è¾“å…¥ç”¨æˆ·åï¼šroot
4. è¾“å…¥æ‚¨åˆšæ‰è®¾ç½®çš„å¯†ç 

**æ–¹æ³•Bï¼šä½¿ç”¨SSHå®¢æˆ·ç«¯ï¼ˆæ¨èï¼‰**
```bash
# åœ¨æ‚¨çš„æœ¬åœ°ç»ˆç«¯æ‰§è¡Œ
ssh root@113.45.64.145
# è¾“å…¥å¯†ç åå³å¯ç™»å½•
```

**æ–¹æ³•Cï¼šä½¿ç”¨VNCç™»å½•**
1. ç‚¹å‡»"VNCç™»å½•"æŒ‰é’®
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

---

## ğŸš€ ç¬¬äºŒæ­¥ï¼šä¸€é”®éƒ¨ç½²ç½‘ç«™

### è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š

```bash
#!/bin/bash

echo "=== åä¸ºäº‘æœåŠ¡å™¨ç½‘ç«™è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ ==="

# æ›´æ–°ç³»ç»ŸåŒ…
echo "ğŸ“¦ æ›´æ–°ç³»ç»Ÿ..."
apt update && apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
echo "ğŸ“¥ å®‰è£…nginxå’Œå¿…è¦å·¥å…·..."
apt install -y nginx curl wget git unzip

# åˆ›å»ºç½‘ç«™ç›®å½•
echo "ğŸ“ åˆ›å»ºç½‘ç«™ç›®å½•..."
mkdir -p /var/www/ndtool
cd /var/www/ndtool

# ä¸‹è½½æˆ–åˆ›å»ºç½‘ç«™æ–‡ä»¶
echo "ğŸ“„ åˆ›å»ºç½‘ç«™æ–‡ä»¶..."
cat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ND Tool - ä¸“ä¸šå¼€å‘å·¥å…·å¹³å°</title>
    <meta name="description" content="ND Toolæä¾›ä¸“ä¸šçš„å¼€å‘å·¥å…·å’ŒæœåŠ¡ï¼ŒåŠ©åŠ›æ‚¨çš„é¡¹ç›®å¼€å‘">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
            text-align: center;
        }
        h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .subtitle {
            font-size: 1.5rem;
            opacity: 0.9;
        }
        .features {
            padding: 80px 0;
            background: #f8f9fa;
        }
        .features h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 30px 0;
        }
        .status {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸš€ ND Tool</h1>
            <p class="subtitle">ä¸“ä¸šå¼€å‘å·¥å…·å¹³å°</p>
            <div class="status">âœ… åä¸ºäº‘æœåŠ¡å™¨è¿è¡Œä¸­</div>
        </div>
    </header>

    <section class="features">
        <div class="container">
            <h2>âœ¨ æ ¸å¿ƒåŠŸèƒ½</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ› ï¸</div>
                    <h3>å¼€å‘å·¥å…·</h3>
                    <p>æä¾›å„ç±»ä¸“ä¸šå¼€å‘å·¥å…·ï¼Œæå‡å¼€å‘æ•ˆç‡</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <h3>é«˜æ€§èƒ½</h3>
                    <p>åŸºäºåä¸ºäº‘æœåŠ¡å™¨ï¼Œä¿è¯æœåŠ¡ç¨³å®šé«˜æ•ˆ</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”’</div>
                    <h3>å®‰å…¨å¯é </h3>
                    <p>ä¼ä¸šçº§å®‰å…¨ä¿éšœï¼Œæ•°æ®åŠ å¯†ä¼ è¾“</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2024 ND Tool | éƒ¨ç½²äºåä¸ºäº‘</p>
            <p style="margin-top: 10px; opacity: 0.7;">æœåŠ¡å™¨IP: 113.45.64.145</p>
        </div>
    </footer>
</body>
</html>
EOF

# é…ç½®nginx
echo "âš™ï¸ é…ç½®nginx..."
cat > /etc/nginx/sites-available/ndtool << 'NGINX_EOF'
server {
    listen 80;
    server_name ndtool.cn www.ndtool.cn 113.45.64.145;

    root /var/www/ndtool;
    index index.html;

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/ndtool.access.log;
    error_log /var/log/nginx/ndtool.error.log;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;

    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # ä¸»é¡µé¢
    location / {
        try_files $uri $uri/ =404;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
NGINX_EOF

# å¯ç”¨ç½‘ç«™é…ç½®
echo "ğŸ”— å¯ç”¨ç½‘ç«™é…ç½®..."
ln -sf /etc/nginx/sites-available/ndtool /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default

# è®¾ç½®æ–‡ä»¶æƒé™
echo "ğŸ” è®¾ç½®æ–‡ä»¶æƒé™..."
chown -R www-data:www-data /var/www/ndtool
chmod -R 755 /var/www/ndtool

# æµ‹è¯•nginxé…ç½®
echo "ğŸ§ª æµ‹è¯•nginxé…ç½®..."
nginx -t

# é‡å¯nginx
echo "ğŸ”„ é‡å¯nginx..."
systemctl restart nginx
systemctl enable nginx

# é…ç½®é˜²ç«å¢™ï¼ˆå¦‚æœéœ€è¦ï¼‰
if command -v ufw &> /dev/null; then
    echo "ğŸ”¥ é…ç½®é˜²ç«å¢™..."
    ufw allow 22
    ufw allow 80
    ufw allow 443
    ufw --force enable
fi

echo ""
echo "âœ… ====== ç½‘ç«™éƒ¨ç½²å®Œæˆï¼ ======"
echo ""
echo "ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯ï¼š"
echo "   - å…¬ç½‘IP: 113.45.64.145"
echo "   - ç½‘ç«™è·¯å¾„: /var/www/ndtool"
echo "   - Nginxé…ç½®: /etc/nginx/sites-available/ndtool"
echo ""
echo "ğŸŒ è®¿é—®åœ°å€ï¼š"
echo "   - http://113.45.64.145"
echo "   - http://ndtool.cn (éœ€è¦é…ç½®DNS)"
echo ""
echo "ğŸ” å¸¸ç”¨å‘½ä»¤ï¼š"
echo "   - æŸ¥çœ‹nginxçŠ¶æ€: systemctl status nginx"
echo "   - é‡å¯nginx: systemctl restart nginx"
echo "   - æŸ¥çœ‹è®¿é—®æ—¥å¿—: tail -f /var/log/nginx/ndtool.access.log"
echo "   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—: tail -f /var/log/nginx/ndtool.error.log"
echo ""
```

---

## ğŸŒ ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåè§£æï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨æƒ³ä½¿ç”¨ `ndtool.cn` åŸŸåè®¿é—®ï¼š

### åœ¨åŸŸåæœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ï¼‰é…ç½®DNSè§£æï¼š

1. **ç™»å½•åŸŸåç®¡ç†æ§åˆ¶å°**
2. **æ‰¾åˆ°åŸŸå ndtool.cn**
3. **æ·»åŠ Aè®°å½•**ï¼š
   - è®°å½•ç±»å‹: **A**
   - ä¸»æœºè®°å½•: **@**
   - è®°å½•å€¼: **113.45.64.145**
   - TTL: **600**

4. **å†æ·»åŠ ä¸€æ¡Aè®°å½•**ï¼š
   - è®°å½•ç±»å‹: **A**
   - ä¸»æœºè®°å½•: **www**
   - è®°å½•å€¼: **113.45.64.145**
   - TTL: **600**

DNSç”Ÿæ•ˆæ—¶é—´ï¼šé€šå¸¸5-10åˆ†é’Ÿ

---

## ğŸ”’ ç¬¬å››æ­¥ï¼šé…ç½®HTTPSï¼ˆæ¨èï¼‰

### ä½¿ç”¨Let's Encryptå…è´¹SSLè¯ä¹¦ï¼š

```bash
# å®‰è£…Certbot
apt install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦ï¼ˆDNSç”Ÿæ•ˆåæ‰§è¡Œï¼‰
certbot --nginx -d ndtool.cn -d www.ndtool.cn

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
echo "0 12 * * * /usr/bin/certbot renew --quiet" | crontab -
```

---

## ğŸ§ª ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯

### 1. æœ¬åœ°æµ‹è¯•
```bash
curl -I http://113.45.64.145
```

### 2. æµè§ˆå™¨æµ‹è¯•
- è®¿é—®ï¼šhttp://113.45.64.145
- åº”è¯¥çœ‹åˆ°ç½‘ç«™é¦–é¡µ

### 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥nginxçŠ¶æ€
systemctl status nginx

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tlnp | grep :80

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep nginx
```

### 4. æŸ¥çœ‹æ—¥å¿—
```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/ndtool.access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/ndtool.error.log
```

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ— æ³•SSHè¿æ¥
```bash
# ç¡®è®¤å®‰å…¨ç»„å·²å¼€æ”¾22ç«¯å£
# ç¡®è®¤å¯†ç æ­£ç¡®
# å°è¯•ä½¿ç”¨åä¸ºäº‘æ§åˆ¶å°çš„VNC/CloudShellç™»å½•
```

### 2. ç½‘ç«™æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥nginxçŠ¶æ€
systemctl status nginx

# æ£€æŸ¥é˜²ç«å¢™
ufw status

# æ£€æŸ¥åä¸ºäº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾80ç«¯å£
# åœ¨åä¸ºäº‘æ§åˆ¶å°æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
```

### 3. nginxå¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
nginx -t

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u nginx -n 50
```

### 4. 403 Forbiddené”™è¯¯
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/ndtool/

# é‡æ–°è®¾ç½®æƒé™
chown -R www-data:www-data /var/www/ndtool
chmod -R 755 /var/www/ndtool
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨åä¸ºäº‘CDN
- ç™»å½•åä¸ºäº‘CDNæ§åˆ¶å°
- æ·»åŠ åŠ é€ŸåŸŸå
- é…ç½®æºç«™ä¸ºæ‚¨çš„æœåŠ¡å™¨IP
- å¼€å¯ç¼“å­˜å’Œå‹ç¼©åŠŸèƒ½

### 2. é…ç½®æœåŠ¡å™¨ç›‘æ§
- åœ¨åä¸ºäº‘æ§åˆ¶å°å¯ç”¨äº‘ç›‘æ§
- è®¾ç½®CPUã€å†…å­˜ã€å¸¦å®½å‘Šè­¦
- é…ç½®æ—¥å¿—æœåŠ¡

### 3. å®šæœŸå¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /root/backup-website.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/root/backups"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/ndtool_$DATE.tar.gz /var/www/ndtool /etc/nginx/sites-available/ndtool
find $BACKUP_DIR -name "ndtool_*.tar.gz" -mtime +7 -delete
EOF

chmod +x /root/backup-website.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
echo "0 2 * * * /root/backup-website.sh" | crontab -
```

---

## ğŸ“ è·å–å¸®åŠ©

### åä¸ºäº‘æŠ€æœ¯æ”¯æŒ
- 7Ã—24å°æ—¶åœ¨çº¿æ”¯æŒ
- æäº¤å·¥å•è·å–å¸®åŠ©
- æŸ¥çœ‹åä¸ºäº‘å®˜æ–¹æ–‡æ¡£

### å¸¸ç”¨æ–‡æ¡£é“¾æ¥
- [åä¸ºäº‘ECSä½¿ç”¨æŒ‡å—](https://support.huaweicloud.com/ecs/index.html)
- [å®‰å…¨ç»„é…ç½®æŒ‡å—](https://support.huaweicloud.com/usermanual-ecs/ecs_03_0120.html)
- [åŸŸåå¤‡æ¡ˆæµç¨‹](https://beian.huaweicloud.com/)

---

## ğŸ‰ éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨å¯†ç å·²è®¾ç½®å¹¶èƒ½æˆåŠŸç™»å½•
- [ ] å®‰å…¨ç»„è§„åˆ™å·²é…ç½®ï¼ˆ22, 80, 443ç«¯å£å¼€æ”¾ï¼‰
- [ ] Nginxå·²å®‰è£…å¹¶æ­£å¸¸è¿è¡Œ
- [ ] ç½‘ç«™æ–‡ä»¶å·²éƒ¨ç½²åˆ° /var/www/ndtool
- [ ] é€šè¿‡IPåœ°å€å¯ä»¥è®¿é—®ç½‘ç«™
- [ ] ï¼ˆå¯é€‰ï¼‰åŸŸåDNSå·²é…ç½®
- [ ] ï¼ˆå¯é€‰ï¼‰SSLè¯ä¹¦å·²å®‰è£…

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **ç½‘ç«™å¤‡æ¡ˆ**ï¼šå¦‚æœä½¿ç”¨å›½å†…æœåŠ¡å™¨å’ŒåŸŸåï¼Œéœ€è¦å®ŒæˆICPå¤‡æ¡ˆ
2. **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®æœåŠ¡å™¨å’Œç½‘ç«™ç›‘æ§
3. **å®‰å…¨åŠ å›º**ï¼š
   - ä¿®æ”¹SSHé»˜è®¤ç«¯å£
   - ç¦ç”¨rootå¯†ç ç™»å½•ï¼Œä½¿ç”¨å¯†é’¥è®¤è¯
   - å®‰è£…fail2bané˜²æ­¢æš´åŠ›ç ´è§£
4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - é…ç½®CDNåŠ é€Ÿ
   - ä¼˜åŒ–nginxé…ç½®
   - å¯ç”¨HTTP/2

ç°åœ¨æ‚¨çš„ç½‘ç«™å·²ç»æˆåŠŸéƒ¨ç½²åˆ°åä¸ºäº‘æœåŠ¡å™¨ï¼ğŸ‰

