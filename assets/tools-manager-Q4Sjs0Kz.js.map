{"version":3,"file":"tools-manager-Q4Sjs0Kz.js","sources":["../../src/js/tools-manager.js"],"sourcesContent":["// 工具管理器\nimport { frontendDownloadManager } from './modules/frontend-download-manager.js';\n\n/** @typedef {Object} Tool\n * @property {string} id\n * @property {string} name\n * @property {string} description\n * @property {string} version\n * @property {string} size\n * @property {boolean} [hasUpdate]\n * @property {string} [latestVersion]\n */\n\nclass ToolsManager {\n    /** @type {HTMLElement | null} */\n    toolsContainer;\n    /** @type {Tool[]} */\n    tools;\n    /** @type {ReturnType<typeof setTimeout> | null} */\n    updateInterval;\n\n    constructor() {\n        this.toolsContainer = document.getElementById('tools-container');\n        this.tools = [];\n        this.updateInterval = null;\n        this.init();\n    }\n\n    async init() {\n        try {\n            // 只从本地配置加载工具信息，不再依赖后端API\n            const toolsResponse = await fetch('/config/tools.json');\n            \n            if (!toolsResponse.ok) {\n                throw new Error(`HTTP error! status: ${toolsResponse.status}`);\n            }\n            \n            const toolsData = await toolsResponse.json();\n            \n            // 使用本地版本信息\n            this.tools = toolsData.tools.map(tool => ({\n                ...tool,\n                hasUpdate: false, // 不再检查更新\n                latestVersion: tool.version\n            }));\n            \n            this.renderTools();\n            this.setupUpdateChecker();\n        } catch (error) {\n            console.error('加载工具列表失败:', error);\n            this.showError('加载工具列表失败，请刷新页面重试');\n        }\n    }\n\n    setupUpdateChecker() {\n        // 每6小时检查一次本地配置文件\n        this.updateInterval = setInterval(async () => {\n            try {\n                const response = await fetch('/config/tools.json');\n                if (!response.ok) return;\n                \n                const toolsData = await response.json();\n                // 只更新工具信息，不检查版本更新\n                this.tools = toolsData.tools.map(newTool => {\n                    const existingTool = this.tools.find(t => t.id === newTool.id);\n                    return {\n                        ...newTool,\n                        hasUpdate: false,\n                        latestVersion: newTool.version\n                    };\n                });\n                \n                this.renderTools();\n            } catch (error) {\n                console.error('更新工具信息失败:', error);\n            }\n        }, 6 * 60 * 60 * 1000);\n    }\n\n    renderTools() {\n        if (!this.toolsContainer) {\n            console.error('找不到工具容器元素');\n            return;\n        }\n        \n        this.toolsContainer.innerHTML = this.tools.map((/** @type {Tool} */ tool, index) => `\n            <div class=\"tool-card\" style=\"animation-delay: ${index * 0.1}s\">\n                <h3 class=\"tool-name\">${tool.name}</h3>\n                <p class=\"tool-description\">${tool.description}</p>\n                <div class=\"tool-meta\">\n                    <span>版本 ${tool.version}</span>\n                    <span class=\"tool-size\">${tool.size}</span>\n                </div>\n                <button class=\"download-button\" onclick=\"toolsManager.downloadTool('${tool.id}')\">\n                    下载\n                </button>\n            </div>\n        `).join('');\n    }\n\n    /**\n     * 下载工具\n     * @param {string} toolId 工具ID\n     */\n    async downloadTool(toolId) {\n        try {\n            await frontendDownloadManager.downloadTool(toolId);\n        } catch (/** @type {any} */ error) {\n            this.showError('下载失败：' + error.message);\n        }\n    }\n\n    /**\n     * 显示错误信息\n     * @param {string} message 错误信息\n     */\n    showError(message) {\n        const errorDiv = document.createElement('div');\n        errorDiv.className = 'error-message';\n        errorDiv.textContent = message;\n        document.body.appendChild(errorDiv);\n        setTimeout(() => errorDiv.remove(), 3000);\n    }\n}\n\n// 初始化工具管理器\nwindow.addEventListener('DOMContentLoaded', () => {\n    /** @type {Window & { toolsManager?: ToolsManager }} */\n    const win = window;\n    win.toolsManager = new ToolsManager();\n});\n"],"names":["ToolsManager","constructor","__publicField","this","toolsContainer","document","getElementById","tools","updateInterval","init","toolsResponse","fetch","ok","Error","status","toolsData","json","map","tool","hasUpdate","latestVersion","version","renderTools","setupUpdateChecker","error","console","showError","setInterval","async","response","newTool","find","t","id","innerHTML","index","name","description","size","join","downloadTool","toolId","frontendDownloadManager","message","errorDiv","createElement","className","textContent","body","appendChild","setTimeout","remove","window","addEventListener","toolsManager"],"mappings":"kPAaA,MAAMA,EAQF,WAAAC,GANAC,EAAAC,KAAA,kBAEAD,EAAAC,KAAA,SAEAD,EAAAC,KAAA,kBAGSA,KAAAC,eAAiBC,SAASC,eAAe,mBAC9CH,KAAKI,MAAQ,GACbJ,KAAKK,eAAiB,KACtBL,KAAKM,MACb,CAEI,UAAMA,GACE,IAEM,MAAAC,QAAsBC,MAAM,sBAE9B,IAACD,EAAcE,GACf,MAAM,IAAIC,MAAM,uBAAuBH,EAAcI,UAGnD,MAAAC,QAAkBL,EAAcM,OAGtCb,KAAKI,MAAQQ,EAAUR,MAAMU,KAAaC,IAAA,IACnCA,EACHC,WAAW,EACXC,cAAeF,EAAKG,YAGxBlB,KAAKmB,cACLnB,KAAKoB,oBACR,OAAQC,GACGC,QAAAD,MAAM,YAAaA,GAC3BrB,KAAKuB,UAAU,mBAC3B,CACA,CAEI,kBAAAH,GAESpB,KAAAK,eAAiBmB,aAAYC,UAC1B,IACM,MAAAC,QAAiBlB,MAAM,sBACzB,IAACkB,EAASjB,GAAI,OAEZ,MAAAG,QAAkBc,EAASb,OAEjCb,KAAKI,MAAQQ,EAAUR,MAAMU,KAAea,IACnB3B,KAAKI,MAAMwB,SAAUC,EAAEC,KAAOH,EAAQG,KACpD,MAAA,IACAH,EACHX,WAAW,EACXC,cAAeU,EAAQT,QAC1B,IAGLlB,KAAKmB,aACR,OAAQE,GACGC,QAAAD,MAAM,YAAaA,EAC3C,IACW,MACX,CAEI,WAAAF,GACSnB,KAAKC,eAKVD,KAAKC,eAAe8B,UAAY/B,KAAKI,MAAMU,KAAI,CAAqBC,EAAMiB,IAAU,gEACvB,GAARA,+CACrBjB,EAAKkB,0DACClB,EAAKmB,0FAEpBnB,EAAKG,+DACUH,EAAKoB,4HAEmCpB,EAAKe,4FAIhFM,KAAK,IAhBJd,QAAQD,MAAM,YAiB1B,CAMI,kBAAMgB,CAAaC,GACX,UACMC,EAAwBF,aAAaC,EAC9C,OAA2BjB,GACnBrB,KAAAuB,UAAU,QAAUF,EAAMmB,QAC3C,CACA,CAMI,SAAAjB,CAAUiB,GACA,MAAAC,EAAWvC,SAASwC,cAAc,OACxCD,EAASE,UAAY,gBACrBF,EAASG,YAAcJ,EACdtC,SAAA2C,KAAKC,YAAYL,GAC1BM,YAAW,IAAMN,EAASO,UAAU,IAC5C,EAIAC,OAAOC,iBAAiB,oBAAoB,KAE5BD,OACRE,aAAe,IAAItD,CAAc"}