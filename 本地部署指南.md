# 本地电脑内网穿透部署指南

## ✅ 当前状态

- ✅ Nginx 已安装并运行
- ✅ 网站已部署到 `/var/www/ndtool/`
- ✅ Ngrok 已下载并配置
- ✅ 本地访问正常（http://localhost）

---

## 🚀 让域名 ndtool.cn 在公网访问的步骤

### 方案 A：使用 Ngrok（推荐，适合临时使用）

#### 1. 注册 Ngrok 账号
访问：https://dashboard.ngrok.com/signup
- 可以用 Google/GitHub 快速注册
- 完全免费

#### 2. 获取并配置 Authtoken
登录后，在 Dashboard 页面复制你的 **authtoken**

在终端运行：
```bash
cd /home/hongfuyang/公共/网站建设
./ngrok config add-authtoken YOUR_TOKEN_这里替换成你的token
```

#### 3. 启动内网穿透
```bash
./start-ngrok.sh
```

或者直接运行：
```bash
./ngrok http 80
```

#### 4. 获取公网地址
启动后，ngrok 会显示一个公网地址，类似：
```
Forwarding    https://xxxx-xxx-xxx-xxx.ngrok-free.app -> http://localhost:80
```

**这个地址就可以在公网访问你的网站了！**

#### 5. （可选）绑定自定义域名 ndtool.cn

**免费版不支持自定义域名，需要升级到付费版（$8/月）**

如果升级到付费版：
```bash
./ngrok http 80 --domain=ndtool.cn
```

然后在阿里云域名控制台添加 CNAME 记录：
- 记录类型：CNAME
- 主机记录：@
- 记录值：ngrok 提供的 CNAME 地址

---

### 方案 B：使用 Cpolar（支持免费自定义域名）

#### 1. 安装 Cpolar
```bash
curl -L https://www.cpolar.com/static/downloads/install-release-cpolar.sh | sudo bash
```

#### 2. 注册并获取 Token
访问：https://dashboard.cpolar.com/signup
注册后获取 authtoken

#### 3. 配置并启动
```bash
cpolar authtoken YOUR_TOKEN
cpolar http 80
```

#### 4. 配置自定义域名
- 在 Cpolar 控制台添加域名 `ndtool.cn`
- 在阿里云添加 CNAME 解析

---

### 方案 C：使用 Serveo（最简单，无需注册）

直接运行：
```bash
ssh -R 80:localhost:80 serveo.net
```

会自动分配一个公网地址，无需注册！

---

## 📋 域名解析配置

### 如果使用内网穿透的自定义域名功能

在阿里云域名控制台（https://dc.console.aliyun.com/）：

1. 进入域名管理
2. 点击 `ndtool.cn` 的"解析"
3. 添加记录：
   - **记录类型**：CNAME
   - **主机记录**：@
   - **记录值**：内网穿透服务提供的 CNAME 地址
   - **TTL**：600

---

## 🔧 管理命令

### 查看 Nginx 状态
```bash
sudo systemctl status nginx
```

### 重启 Nginx
```bash
sudo systemctl restart nginx
```

### 停止内网穿透
按 `Ctrl + C` 停止 ngrok 进程

### 更新网站内容
```bash
sudo cp index.html /var/www/ndtool/
sudo systemctl restart nginx
```

---

## 💡 注意事项

1. **电脑需要保持开机**：本地电脑关机后，网站就无法访问
2. **网络稳定性**：家庭网络可能不如云服务器稳定
3. **免费版限制**：
   - Ngrok 免费版不支持自定义域名
   - 有连接数限制
   - 每次重启地址会变化

4. **推荐长期方案**：
   - 如果需要长期稳定使用，建议购买云服务器
   - 费用约 100-300 元/年
   - 可以使用项目中的 `quick-deploy.sh` 一键部署

---

## 🎯 快速测试

启动 ngrok 后，在浏览器访问 ngrok 提供的地址，应该能看到你的网站！

---

## 🆘 常见问题

### Q: Ngrok 连接失败？
A: 检查是否已配置 authtoken，确保网络正常

### Q: 访问速度慢？
A: 免费的内网穿透服务可能较慢，考虑使用国内服务如 Cpolar

### Q: 想要固定域名？
A: 升级到付费版或购买云服务器

---

## 📞 需要帮助？

如果遇到问题，可以：
1. 查看 ngrok 日志
2. 检查 nginx 错误日志：`sudo tail -f /var/log/nginx/error.log`
3. 测试本地访问：`curl http://localhost`
